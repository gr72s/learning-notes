- 默认为 cygwin 环境

# 套接字结构

- 这一节主要介绍了 ipv4/ipv6 等套接字结构, 着重介绍了 sockaddr_in(ipv4)中字段用处和联系. 具体的实现与厂商相关. 
- 标准的字段有 family/port/addr, ipv4的实现使用sin_zero字段留出1字节的空白用于填充自定义数据. 
- 每个字段有长度的最低限制, len 和 family 字段加一起通常最大为 2 字节. port 字段因为需要满足端口数最大为 65535 的要求, 至少为 2 字节. addr 字段至少为 4 字节, 因为需要满足每字节 0-255 的要求. 可以使用的类型在sys/types.h中有定义
- 套接字结构的命名与协议(address family)相关. 通用套接字命名为 sockaddr, ipv4 与 ipv6 的 address family 分别为 AF_INET 与 AF_INET6, 所以套接字名称分别为 sockaddr_in 与 sockaddr_in6(in 作为 INET 的简写)
- 

- ipv4 结构

  ```c
  <netinet/in.h>

  struct sockaddr_in {
     uint8_t        sin_len;     // 非POSIX规范字段
     sa_family_t    sin_family;  // 类型为uint16_t
     in_port_t      sin_port;    // uint16_t
     struct in_addr sin_addr;    // uint32_t
     char           sin_zero[8];
  }

  struct in_addr {
     in_addr_t s_addr;  // uint32_t
  }
  ```

  - sin_family: 用于标识套接字协议. 如果有 sin_len 字段, 则两个字段各为 uint8_t
  - sin_port: 至少为 2 字节, 因为端口最大数为 2^16-1=65535
  - sin_zero[8]: 留白用于存放额外字段, 非标准的默认实现
  - 标准的 ipv4 结构只有 sin_family/sin_port/sin_addr, 加上 sin_zero 共有 16 字节

- 通用套接字结构

  ```c
  <sys/socket.h>

  struct sockaddr {
     uint8_t     sa_len;
     sa_family_t sa_family;
     char        sa_data[14];
  }
  ```

  - 套接字函数的入参为 sockaddr 结构, 其它结构作为入参传递给套接字函数时需要强制转换
  - 长度与 sockaddr_in 一样同为 16 字节

- todo
  - [ ] p58 编译器对传递结构和传递整数的处理是完全不同的
  - [ ] ipv6
  - [ ] 值-结果参数

1. 字节排序/字节操作函数
2. 网络序/字节序的地址转换函数
3. 书中实现的通用套接字转换方法
4. 书中实现的读写方法

# 如何使用
